server {
  listen 80;

  # -------------------------
  # Serve static frontend
  # -------------------------
  location / {
    root /usr/share/nginx/html;
    index index.html;
    try_files $uri $uri/ /index.html;
  }

  # -------------------------
  # Proxy API routes
  # -------------------------

  # Product service: /api/products → http://product-service:3003/products
  location /api/products {
    proxy_pass http://product-service:3003/products;
  }

  # Order service: /api/orders → http://order-service:3001/order
  location /api/orders {
    proxy_pass http://order-service:3001/order;
  }

  # Cart service:
  # Exact match: /api/cart
  location = /api/cart {
    proxy_pass http://cart-service:3002/cart;
  }

  # Wildcard match: /api/cart/* → http://cart-service:3002/cart/*
  location /api/cart/ {
    rewrite ^/api/cart(/.*)$ $1 break;
    proxy_pass http://cart-service:3002/cart;
  }

  # -------------------------
  # Optional: Static asset CORS (JS, fonts, images, etc.)
  # -------------------------
  location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|otf)$ {
    add_header Access-Control-Allow-Origin *;
    expires 30d;
    access_log off;
  }
}
